/*
 ThemifyGradient
 Enhanced version of ClassyGradient, with RGBA support

 Original script written by Marius Stanciu - Sergiu <marius@vox.space>
 Licensed under the MIT license https://vox.SPACE/LICENSE-MIT
 Version 1.1.1

*/
var $jscomp=$jscomp||{};$jscomp.scope={};$jscomp.findInternal=function(a,l,c){a instanceof String&&(a=String(a));for(var n=a.length,k=0;k<n;k++){var m=a[k];if(l.call(c,m,k,a))return{i:k,v:m}}return{i:-1,v:void 0}};$jscomp.defineProperty="function"==typeof Object.defineProperties?Object.defineProperty:function(a,l,c){a!=Array.prototype&&a!=Object.prototype&&(a[l]=c.value)};$jscomp.getGlobal=function(a){return"undefined"!=typeof window&&window===a?a:"undefined"!=typeof global&&null!=global?global:a};
$jscomp.global=$jscomp.getGlobal(this);$jscomp.polyfill=function(a,l,c,n){if(l){c=$jscomp.global;a=a.split(".");for(n=0;n<a.length-1;n++){var k=a[n];k in c||(c[k]={});c=c[k]}a=a[a.length-1];n=c[a];l=l(n);l!=n&&null!=l&&$jscomp.defineProperty(c,a,{configurable:!0,writable:!0,value:l})}};$jscomp.polyfill("Array.prototype.find",function(a){return a?a:function(a,c){return $jscomp.findInternal(this,a,c).v}},"es6-impl","es3");
(function(a){a.ThemifyGradient=function(l,c){var n={gradient:a.ThemifyGradient["default"],width:200,height:15,point:8,angle:180,circle:!1,type:"linear",onChange:function(){},onInit:function(){}},k=a(l),m,r,p,t,q,v,u,f=[];this.isInit=!1;this.settings={};this.__constructor=function(){this.settings=a.extend({},n,c);this.update();this.settings.onInit();this.isInit=!0;return this};this.updateSettings=function(d){this.settings=a.extend({},n,d);this.update();return this};this.update=function(){this._setupPoints();
this._setup();this._render()};this.getCSSvalue=function(){var d=this.settings.angle+"deg,";"radial"===this.settings.type&&(d=this.settings.circle?"circle,":"");for(var a=[],b=0,h=f.length;b<h;++b)a.push(f[b][1]+" "+f[b][0]);return this.settings.type+"-gradient("+d+a.join(", ")+")"};this.getString=function(){for(var d="",a=0,b=f.length;a<b;++a)d+=f[a][0]+" "+f[a][1]+"|";return d=d.substr(0,d.length-1)};this.setType=function(a){this.settings.type=a;this.settings.onChange(this.getString(),this.getCSSvalue())};
this.setAngle=function(a){this.settings.angle=a;this.settings.onChange(this.getString(),this.getCSSvalue())};this.setRadialCircle=function(a){this.settings.circle=a;this.settings.onChange(this.getString(),this.getCSSvalue())};this._setupPoints=function(){f=[];f=a.isArray(this.settings.gradient)?this.settings.gradient:this._getGradientFromString(this.settings.gradient)};this._setup=function(){var d=this,g=document.createDocumentFragment(),b=document.createDocumentFragment(),h=document.createElement("div"),
e=document.createElement("div"),w=document.createElement("span"),c=document.createElement("canvas"),l=document.createElement("span");q=document.createElement("a");p=document.createElement("div");t=document.createElement("input");m=document.createElement("div");r=document.createElement("div");h.setAttribute("class","themifyGradient");c.setAttribute("width",this.settings.width);c.setAttribute("height",this.settings.height);m.style.width=this.settings.width+Math.round(this.settings.point/2+1)+"px";m.setAttribute("class",
"points");p.setAttribute("class","point-color");w.setAttribute("class","gradient_delimiter");l.setAttribute("class","gradient_percent");l.innerHTML="%";t.setAttribute("type","text");t.setAttribute("class","point-position");q.setAttribute("class","gradient-point-delete");q.setAttribute("href","#");e.setAttribute("class","gradient-pointer-info");r.setAttribute("class","content");p.insertAdjacentHTML("afterbegin",'<div style="background-color: #00ff00"></div>');q.insertAdjacentHTML("afterbegin",'<i class="ti-close"></i>');
e.insertAdjacentHTML("afterbegin",'<div class="gradient-pointer-arrow"></div>');b.appendChild(p);b.appendChild(w);b.appendChild(t);b.appendChild(l);b.appendChild(q);r.appendChild(b);g.appendChild(c);g.appendChild(m);e.appendChild(r);g.appendChild(e);h.appendChild(g);b=w=l=g=null;k[0].innerHTML="";k[0].appendChild(h);h=e=null;r=a(r);p=a(p);t=a(t);q=a(q);m=a(m);v=c.getContext("2d");c=a(c);c.off("click").on("click",function(a){var b=c.offset();a=a.pageX-b.left;a=Math.round(100*a/d.settings.width);for(var b=
"rgba(0,0,0, 1)",g=999999999999,e=0,h=f.length;e<h;++e)f[e][0]=parseInt(f[e][0]),f[e][0]<a&&a-f[e][0]<g?(g=a-f[e][0],b=f[e][1]):f[e][0]>a&&f[e][0]-a<g&&(g=f[e][0]-a,b=f[e][1]);f.push([a+"%",b]);f.sort(d._sortByPosition);d._render();e=0;for(h=f.length;e<h;++e)f[e][0]===a+"%"&&d._selectPoint(m.find(".point:eq("+e+")"));"visual"===themifybuilderapp.mode&&setTimeout(d._colorPickerPosition,315)});this.pointEvents()};this.pointEvents=function(){var d=this;k.find(".point-position").off("keyup focusout").on("keyup focusout",
function(g){var b=parseInt(a.trim(a(this).val()));isNaN(b)?b=0:0>b?b=Math.abs(b):98<=b&&(b=98);"focusout"!==g.type?(b=Math.round(b*d.settings.width/100),a(this).closest(".themifyGradient").find(".themify_current_point").css("left",b),d._renderCanvas()):a(this).val(b)})};this._render=function(){this._initGradientPoints();this._renderCanvas()};this._colorPickerPosition=function(){var a=ThemifyBuilderCommon.Lightbox.$lightbox,g=r.find(".minicolors"),b=g.find(".minicolors-panel");a.offset().left+a.width()<=
b.offset().left+b.width()?g.addClass("tb_minicolors_right"):g.removeClass("tb_minicolors_right")};this._initGradientPoints=function(){var d=this,g="";m.empty();for(var b=0,h=f.length;b<h;++b)g+='<div class="point" style="background-color: '+f[b][1]+"; left:"+parseInt(f[b][0])*d.settings.width/100+'px;"></div>';m[0].insertAdjacentHTML("afterbegin",g);g=null;m.find(".point").off("click").on("click",function(){d._selectPoint(this);"visual"===themifybuilderapp.mode&&(d._colorPickerPosition(),a(document).trigger("mouseup"))}).draggable({axis:"x",
containment:"parent",start:function(a,b){k.addClass("themify_gradient_drag").focus()},stop:function(b,d){k.removeClass("themify_gradient_drag").focus();"visual"===themifybuilderapp.mode&&a(document).trigger("mouseup")},drag:function(a,b){d._selectPoint(this,!0);d._renderCanvas()}})};this.hexToRgb=function(a){a=a.replace(/^#?([a-f\d])([a-f\d])([a-f\d])$/i,function(a,b,d,e){return b+b+d+d+e+e});return(a=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(a))?{r:parseInt(a[1],16),g:parseInt(a[2],16),b:parseInt(a[3],
16)}:null};this._selectPoint=function(d,g){var b=this;u=a(d);var h=parseInt(u.css("left"));t.val(Math.round(h/this.settings.width*100));h-=30;0>h&&top_iframe.body.classList.contains("tb_module_panel_docked")&&(h=3);k.find(".gradient-pointer-info").css("marginLeft",h+"px");if(g)return!1;k.focus();u.addClass("themify_current_point").siblings().removeClass("themify_current_point");var e=u.css("backgroundColor"),h=e.substr(4,e.length),h=h.substr(0,h.length-1);k.find(".point-color div").remove();h=p.find(".themify-color-picker");
0===h.length&&(h=a('<input type="text" class="themify-color-picker" />'),h.appendTo(p).minicolors({opacity:!0,changeDelay:200,change:function(a,e){var d=b.hexToRgb(a);d||(d={r:255,g:255,b:255},e=1);u.css("backgroundColor","rgba("+d.r+","+d.g+","+d.b+","+e+")");b._renderCanvas()}}),k.find(".minicolors").first().addClass("minicolors-focus"),q.off("click").on("click",function(a){a.preventDefault();1<f.length&&(f.splice(u.index(),1),b._render())}));var e=e.replace(/^rgba?\(|\s+|\)$/g,"").split(","),c=
4===e.length?e.pop():1,e=this._rgbToHex(e);h.val(e).attr("data-opacity",c).data("opacity",c).minicolors("settings",{value:e})};this._renderCanvas=function(){var d=this;f=[];k.find(".point").each(function(){var g=Math.round(parseInt(a(this).css("left"))/d.settings.width*100);f.push([g+"%",a(this).css("backgroundColor")])});f.sort(d._sortByPosition);this._renderToCanvas();if(this.isInit)this.settings.onChange(this.getString(),this.getCSSvalue())};this._renderToCanvas=function(){for(var a=v.createLinearGradient(0,
0,this.settings.width,0),g=0,b=f.length;g<b;++g)a.addColorStop(parseInt(f[g][0])/100,f[g][1]);v.clearRect(0,0,this.settings.width,this.settings.height);v.fillStyle=a;v.fillRect(0,0,this.settings.width,this.settings.height)};this._getGradientFromString=function(a){var d=[];a=a.split("|");for(var b=0,f=a.length;b<f;++b){var e=a[b];var c=e.indexOf("%");var k=e.substr(c-3,c);"100"===k||"100%"===k?c="100%":(c=1<c?parseInt(e.substr(c-2,c)):parseInt(e.substr(c-1,c)),c+="%");d.push([c,e.replace(c,"")])}return d};
this._rgbToHex=function(a){function d(a){a=parseInt(a,10);if(isNaN(a))return"00";a=Math.max(0,Math.min(a,255));return"0123456789ABCDEF".charAt((a-a%16)/16)+"0123456789ABCDEF".charAt(a%16)}var b=a[1],c=a[2];return"#"+d(a[0])+d(b)+d(c)};this._sortByPosition=function(a,c){a=parseInt(a[0]);c=parseInt(c[0]);return a<c?-1:a>c?1:0};return this.__constructor()};a.ThemifyGradient["default"]="0% rgba(0,0,0, 1)|100% rgba(255,255,255,1)";a.fn.ThemifyGradient=function(l){return this.each(function(){void 0===a(this).data("themifyGradient")&&
a(this).data("themifyGradient",new a.ThemifyGradient(this,l))})}})(jQuery);
