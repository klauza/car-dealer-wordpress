(function(b,e,d,c){var f=d.createElement;b.builderUtils={stateInit:!1,number:0,tempHTML:null,vent:_.extend({},Backbone.Events),isRendered:function(){return document.getElementById("tb_toolbar")},saveHTML:function(a){this.isRendered()&&(this.tempHTML=document.getElementById("tb_canvas_block").innerHTML)},restoreHTML:function(a){if("undefined"!==typeof themifybuilderapp&&!_.isNull(this.tempHTML)&&!this.isRendered()&&document.getElementById("tb_canvas_block")&&(document.getElementById("tb_canvas_block").innerHTML=
this.tempHTML,!_.isUndefined(themifybuilderapp.Instances.Builder[0]))){a=document.getElementById("tb_row_wrapper").querySelectorAll("[data-cid]");a=Array.prototype.slice.call(a);for(var b=0,g=a.length;b<g;++b){var d=themifybuilderapp.Models.Registry.lookup(a[b].getAttribute("data-cid"));d&&d.trigger("change:view",a[b])}themifybuilderapp.toolbar.setElement(c("#tb_toolbar")).render();themifybuilderapp.toolbarCallback();themifybuilderapp.Instances.Builder[0].setElement(c("#tb_row_wrapper"));themifybuilderapp.Instances.Builder[0].init(!0)}},
manageState:function(a){"undefined"===typeof themifybuilderapp||this.stateInit||(this.stateInit=!0,console.log("manageState_callback"),themifybuilderapp.vent.on("dom:change",function(){themifybuilderapp.hasChanged&&a.setAttributes({data:b.builderUtils.number++})}),themifybuilderapp.vent.on("backend:switchfrontend",function(a){window.top.location.href=a}))},saveBlock:function(){"undefined"!==typeof themifybuilderapp&&(this.onClicking?this.onClicking=!1:(console.log("save_callback"),themifybuilderapp.hasChanged?
themifybuilderapp.Utils.saveBuilder(this.goToFrontend):this.goToFrontend()))},goToFrontend:function(){themifybuilderapp.redirectFrontend&&themifybuilderapp.vent.trigger("backend:switchfrontend",themifybuilderapp.redirectFrontend)}};b.registerBlockType("themify-builder/canvas",{title:"Themify Builder",icon:"layout",category:"layout",useOnce:!0,attributes:{data:{source:"meta"}},edit:function(a){console.log("edit");b.builderUtils.vent.trigger("edit",a);return f("div",{id:"tb_canvas_block"},"placeholder builder")},
save:function(){console.log("save");return null}});e=_.debounce(function(a){b.builderUtils.saveHTML(a);b.builderUtils.restoreHTML(a);b.builderUtils.manageState(a)},800);d=_.debounce(function(){b.builderUtils.saveBlock()},800);b.builderUtils.vent.on("edit",e);b.builderUtils.vent.on("save",d);c(function(){var a=c("body");a.on("click",".editor-post-publish-button, .editor-post-save-draft",function(a){themifybuilderapp.hasChanged&&themifybuilderapp.Utils.saveBuilder(function(){b.builderUtils.onClicking=
!0})});a.off("click.frontend-btn","#tb_switch_frontend").on("click.frontend-btn","#tb_switch_frontend",function(){var a=c(".editor-post-publish-button");a.bind("DOMSubtreeModified",function(){"Update"!==a.text()||c(".editor-post-saved-state").length||(b.builderUtils.onClicking=!1,b.builderUtils.saveBlock())})})});c(document).ajaxComplete(function(a,c,d){a=d.url;c="post.php?post="+themifyBuilder.post_ID+"&action=edit&classic-editor=1&meta_box=1";"POST"===d.type&&-1!==a.indexOf(c)&&b.builderUtils.vent.trigger("save")})})(window.wp.blocks,
window.wp.i18n,window.wp.element,jQuery);
