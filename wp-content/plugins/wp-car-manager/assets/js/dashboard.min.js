jQuery(function(a){var b=a(".wpcm-dashboard");b&&a.each(b,function(a,b){new WPCM_Dashboard(b)});var c=a(".wpcm-dashboard-profile:first");new WPCM_Dashboard_Profile(c)});var WPCM_Dashboard_Profile=function(a){this.is_editing=!1,this.is_updating=!1,this.wrapper=jQuery(a),this.fields_wrapper=this.wrapper.find(".wpcm-dashboard-profile-fields:first"),this.button=jQuery(this.wrapper.find("h2:first a:first")),this.init()};WPCM_Dashboard_Profile.prototype.init=function(){var a=this;this.load_data(),this.button.click(function(){a.is_editing?a.save():a.edit()})},WPCM_Dashboard_Profile.prototype.load_data=function(){var a={nonce:wpcm.nonce_get_profile};jQuery.getJSON(wpcm.ajax_url_get_profile,a,function(a){var b=a.data;jQuery("#wpcm-dashboard-profile-field-email:first").find(".wpcm-dashboard-profile-value:first").html(b.email),jQuery("#wpcm-dashboard-profile-field-phone:first").find(".wpcm-dashboard-profile-value:first").html(b.phone)})},WPCM_Dashboard_Profile.prototype.edit=function(){this.is_editing||(this.button.html(wpcm.profile_btn_save),this.is_editing=!0,jQuery.each(this.fields_wrapper.find(".wpcm-dashboard-profile-value"),function(a,b){var c=jQuery(b).html();jQuery(b).html(jQuery("<input>").attr("type","text").addClass("wpcm-dashboard-profile-field").attr("data-key",jQuery(b).data("key")).val(c))}))},WPCM_Dashboard_Profile.prototype.save=function(){var a=this,b={};jQuery.each(this.fields_wrapper.find(".wpcm-dashboard-profile-value"),function(a,c){var d=jQuery(c).find("input:first");b[d.data("key")]=d.val()}),jQuery.post(wpcm.ajax_url_save_profile,{nonce:wpcm.nonce_save_profile,data:b},function(b){if(!1===b.success)alert(b.errors.msg);else{a.button.html(wpcm.profile_btn_edit);var c=b.data;jQuery("#wpcm-dashboard-profile-field-email:first").find(".wpcm-dashboard-profile-value:first").html(c.email),jQuery("#wpcm-dashboard-profile-field-phone:first").find(".wpcm-dashboard-profile-value:first").html(c.phone),a.is_editing=!1}})};var WPCM_Dashboard=function(a){this.is_updating=!1,this.listings=jQuery(a).find(".wpcm-dashboard-wrapper>.wpcm-dashboard-list:first"),this.pagination=jQuery(a).find(".wpcm-dashboard-pagination:first"),this.page=1,this.load_vehicles()};WPCM_Dashboard.prototype.load_vehicles=function(){if(1!=this.is_updating){this.is_updating=!0;var a=this,b=this.listings,c=this.pagination,d={nonce:wpcm.nonce_vehicles,page:this.page};this.listings.parent().append(jQuery("<div>").addClass("wpcm-results-load-overlay")),this.listings.parent().append((new WPCM_Spinner).getDOM()),jQuery.getJSON(wpcm.ajax_url_get_vehicles,d,function(d){d.listings&&b.html(d.listings),d.pagination?(c.html(d.pagination),a.bind_pagination()):c.html(""),b.parent().find(".wpcm-results-load-overlay").remove(),b.parent().find(".wpcm-results-spinner").remove(),jQuery(b).find(".wpcm-dashboard-item .wpcm-dashboard-item-actions a.wpcm-dashboard-delete-button").click(function(){return a.deleteVehicle(jQuery(this).closest(".wpcm-dashboard-item")),!1}),a.is_updating=!1})}},WPCM_Dashboard.prototype.bind_pagination=function(){var a=this;jQuery.each(jQuery(this.pagination).find("a"),function(b,c){jQuery(c).click(function(){var b=jQuery(c).data("page");"next"==b&&(b=a.page+1),"prev"==b&&(b=a.page-1),a.page=b,a.load_vehicles()})})},WPCM_Dashboard.prototype.deleteVehicle=function(a){var b=a.data("id"),c=a.data("title");confirm(wpcm.delete_confirm.replace("%s",'"'+c+'"'))&&jQuery.post(wpcm.ajax_url_delete_vehicle,{nonce:wpcm.nonce_delete_vehicle,vehicle:b},function(b){b.success?a.fadeOut("normal",function(){a.remove()}):alert(wpcm.error_delete_vehicle)})};var WPCM_Spinner=function(){return this.el=jQuery("<div>").addClass("wpcm-results-spinner").fadeIn(400,WPCM_Spinner.prototype.fadeOut),jQuery(this.el).bind("fade",function(){jQuery(this).fadeOut("slow",function(){jQuery(this).fadeIn("slow",function(){jQuery(this).trigger("fade")})})}),jQuery(this.el).trigger("fade"),this};WPCM_Spinner.prototype.getDOM=function(){return this.el};